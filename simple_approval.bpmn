<?xml version="1.0" encoding="UTF-8"?>
<ns0:definitions xmlns:ns0="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:ns1="http://camunda.org/schema/zeebe/1.0" xmlns:ns2="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:ns3="http://www.omg.org/spec/DD/20100524/DC" xmlns:ns4="http://www.omg.org/spec/DD/20100524/DI" xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" id="definitions_document-approval" targetNamespace="http://bpmn.io/schema/bpmn" exporter="BPM DSL" exporterVersion="1.0">
  <ns0:process id="document-approval" name="Document Approval" isExecutable="true" versionTag="1.0">
    <ns0:startEvent id="start-submission" name="Document Submitted"/>
    <ns0:scriptTask id="validate-doc" name="Validate Document">
      <ns0:extensionElements>
        <ns1:script expression="validateDocument(document)" resultVariable="result"/>
        <ns1:ioMapping>
          <ns1:input source="document" target="document"/>
          <ns1:output source="isValid" target="isValid"/>
          <ns1:output source="validationErrors" target="validationErrors"/>
        </ns1:ioMapping>
      </ns0:extensionElements>
    </ns0:scriptTask>
    <ns0:exclusiveGateway id="validation-gateway" name="Document Valid?" default="validation-gateway_default_flow"/>
    <ns0:scriptTask id="review-doc" name="Review Document">
      <ns0:extensionElements>
        <ns1:script expression="assignReviewer(document)" resultVariable="result"/>
        <ns1:ioMapping>
          <ns1:input source="document" target="document"/>
          <ns1:output source="reviewer" target="reviewer"/>
          <ns1:output source="reviewDeadline" target="reviewDeadline"/>
        </ns1:ioMapping>
      </ns0:extensionElements>
    </ns0:scriptTask>
    <ns0:scriptTask id="reject-doc" name="Reject Document">
      <ns0:extensionElements>
        <ns1:script expression="rejectDocument(document, validationErrors)" resultVariable="result"/>
        <ns1:ioMapping>
          <ns1:input source="document" target="document"/>
          <ns1:input source="validationErrors" target="validationErrors"/>
          <ns1:output source="rejectionReason" target="rejectionReason"/>
        </ns1:ioMapping>
      </ns0:extensionElements>
    </ns0:scriptTask>
    <ns0:endEvent id="end-approved" name="Document Approved"/>
    <ns0:endEvent id="end-rejected" name="Document Rejected"/>
    <ns0:sequenceFlow id="flow_start-submission_to_validate-doc" sourceRef="start-submission" targetRef="validate-doc"/>
    <ns0:sequenceFlow id="flow_validate-doc_to_validation-gateway" sourceRef="validate-doc" targetRef="validation-gateway"/>
    <ns0:sequenceFlow id="flow_validation-gateway_to_review-doc" sourceRef="validation-gateway" targetRef="review-doc">
      <ns0:conditionExpression ns0:type="tFormalExpression">isValid == true</ns0:conditionExpression>
    </ns0:sequenceFlow>
    <ns0:sequenceFlow id="flow_validation-gateway_to_reject-doc" sourceRef="validation-gateway" targetRef="reject-doc">
      <ns0:conditionExpression ns0:type="tFormalExpression">isValid == false</ns0:conditionExpression>
    </ns0:sequenceFlow>
    <ns0:sequenceFlow id="flow_review-doc_to_end-approved" sourceRef="review-doc" targetRef="end-approved"/>
    <ns0:sequenceFlow id="flow_reject-doc_to_end-rejected" sourceRef="reject-doc" targetRef="end-rejected"/>
  </ns0:process>
  <ns2:BPMNDiagram id="diagram_document-approval">
    <ns2:BPMNPlane id="plane_document-approval" bpmnElement="document-approval">
      <ns2:BPMNShape id="shape_start-submission" bpmnElement="start-submission">
        <ns3:Bounds x="100" y="100" width="100" height="80"/>
      </ns2:BPMNShape>
      <ns2:BPMNShape id="shape_validate-doc" bpmnElement="validate-doc">
        <ns3:Bounds x="250" y="100" width="100" height="80"/>
      </ns2:BPMNShape>
      <ns2:BPMNShape id="shape_validation-gateway" bpmnElement="validation-gateway">
        <ns3:Bounds x="400" y="100" width="100" height="80"/>
      </ns2:BPMNShape>
      <ns2:BPMNShape id="shape_review-doc" bpmnElement="review-doc">
        <ns3:Bounds x="550" y="100" width="100" height="80"/>
      </ns2:BPMNShape>
      <ns2:BPMNShape id="shape_reject-doc" bpmnElement="reject-doc">
        <ns3:Bounds x="700" y="100" width="100" height="80"/>
      </ns2:BPMNShape>
      <ns2:BPMNShape id="shape_end-approved" bpmnElement="end-approved">
        <ns3:Bounds x="850" y="100" width="100" height="80"/>
      </ns2:BPMNShape>
      <ns2:BPMNShape id="shape_end-rejected" bpmnElement="end-rejected">
        <ns3:Bounds x="1000" y="100" width="100" height="80"/>
      </ns2:BPMNShape>
      <ns2:BPMNEdge id="edge_flow_start-submission_to_validate-doc" bpmnElement="flow_start-submission_to_validate-doc">
        <ns4:waypoint x="200" y="140"/>
        <ns4:waypoint x="250" y="140"/>
      </ns2:BPMNEdge>
      <ns2:BPMNEdge id="edge_flow_validate-doc_to_validation-gateway" bpmnElement="flow_validate-doc_to_validation-gateway">
        <ns4:waypoint x="200" y="140"/>
        <ns4:waypoint x="250" y="140"/>
      </ns2:BPMNEdge>
      <ns2:BPMNEdge id="edge_flow_validation-gateway_to_review-doc" bpmnElement="flow_validation-gateway_to_review-doc">
        <ns4:waypoint x="200" y="140"/>
        <ns4:waypoint x="250" y="140"/>
      </ns2:BPMNEdge>
      <ns2:BPMNEdge id="edge_flow_validation-gateway_to_reject-doc" bpmnElement="flow_validation-gateway_to_reject-doc">
        <ns4:waypoint x="200" y="140"/>
        <ns4:waypoint x="250" y="140"/>
      </ns2:BPMNEdge>
      <ns2:BPMNEdge id="edge_flow_review-doc_to_end-approved" bpmnElement="flow_review-doc_to_end-approved">
        <ns4:waypoint x="200" y="140"/>
        <ns4:waypoint x="250" y="140"/>
      </ns2:BPMNEdge>
      <ns2:BPMNEdge id="edge_flow_reject-doc_to_end-rejected" bpmnElement="flow_reject-doc_to_end-rejected">
        <ns4:waypoint x="200" y="140"/>
        <ns4:waypoint x="250" y="140"/>
      </ns2:BPMNEdge>
    </ns2:BPMNPlane>
  </ns2:BPMNDiagram>
</ns0:definitions>
